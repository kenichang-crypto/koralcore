# koralcore æ¶æ§‹è¦–è¦ºåŒ–åœ–

## ğŸ“ æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        koralcore                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ app/ â”‚            â”‚ core/   â”‚          â”‚ domain/  â”‚
    â”‚      â”‚            â”‚         â”‚          â”‚          â”‚
    â”‚ å•Ÿå‹• â”‚            â”‚ BLE     â”‚          â”‚ æ¥­å‹™è¦å‰‡ â”‚
    â”‚ é…ç½® â”‚            â”‚ å¹³å°    â”‚          â”‚ UseCase  â”‚
    â””â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ featuresâ”‚          â”‚ shared/  â”‚          â”‚ data/  â”‚
    â”‚         â”‚          â”‚          â”‚          â”‚        â”‚
    â”‚ UIåŠŸèƒ½  â”‚          â”‚ UIå…±ç”¨   â”‚          â”‚ è³‡æ–™   â”‚
    â”‚         â”‚          â”‚          â”‚          â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ è©³ç´°ç›®éŒ„çµæ§‹

```
lib/
â”‚
â”œâ”€ ğŸ“± app/                          [2 å€‹æ–‡ä»¶]
â”‚  â”œâ”€ main_scaffold.dart
â”‚  â””â”€ navigation_controller.dart
â”‚
â”œâ”€ âš™ï¸ core/                          [29 å€‹æ–‡ä»¶]
â”‚  â””â”€ ble/
â”‚     â”œâ”€ ble_guard.dart
â”‚     â””â”€ ble_readiness_controller.dart
â”‚
â”œâ”€ ğŸ§  domain/                        [æ¥­å‹™è¦å‰‡]
â”‚  â”œâ”€ device/
â”‚  â”œâ”€ led/
â”‚  â”œâ”€ doser/
â”‚  â””â”€ usecases/                     âš¡ UI å”¯ä¸€å…¥å£
â”‚
â”œâ”€ ğŸ’¾ data/                          [è³‡æ–™ä¾†æº]
â”‚  â””â”€ ...
â”‚
â”œâ”€ ğŸ¨ features/                      [71 å€‹æ–‡ä»¶]
â”‚  â”‚
â”‚  â”œâ”€ ğŸ  home/
â”‚  â”‚  â””â”€ presentation/
â”‚  â”‚     â”œâ”€ pages/        [1] home_page.dart
â”‚  â”‚     â”œâ”€ controllers/  [1] home_controller.dart
â”‚  â”‚     â””â”€ widgets/
â”‚  â”‚
â”‚  â”œâ”€ ğŸ“± device/
â”‚  â”‚  â””â”€ presentation/
â”‚  â”‚     â”œâ”€ pages/        [3] device_page, add_device, settings
â”‚  â”‚     â”œâ”€ controllers/   [2] device_list, add_device
â”‚  â”‚     â””â”€ widgets/      [1] device_card
â”‚  â”‚
â”‚  â”œâ”€ ğŸ’¡ led/
â”‚  â”‚  â””â”€ presentation/
â”‚  â”‚     â”œâ”€ pages/        [13] led_main, control, scene, schedule...
â”‚  â”‚     â”œâ”€ controllers/   [9] led_control, scene_list, schedule...
â”‚  â”‚     â”œâ”€ widgets/       [4] spectrum_chart, record_chart...
â”‚  â”‚     â”œâ”€ helpers/       [4] icon_helper, scene_helper...
â”‚  â”‚     â””â”€ models/        [2] led_scene_summary, schedule_summary
â”‚  â”‚
â”‚  â”œâ”€ ğŸ’§ doser/
â”‚  â”‚  â””â”€ presentation/
â”‚  â”‚     â”œâ”€ pages/        [å¤šå€‹] dosing_main, pump_head...
â”‚  â”‚     â”œâ”€ controllers/
â”‚  â”‚     â””â”€ models/
â”‚  â”‚
â”‚  â”œâ”€ ğŸ“¡ bluetooth/
â”‚  â”‚  â””â”€ presentation/
â”‚  â”‚     â””â”€ pages/        [1] bluetooth_page
â”‚  â”‚
â”‚  â”œâ”€ ğŸš€ splash/
â”‚  â”‚  â””â”€ presentation/
â”‚  â”‚     â””â”€ pages/        [1] splash_page
â”‚  â”‚
â”‚  â”œâ”€ ğŸŠ sink/
â”‚  â”‚  â””â”€ presentation/
â”‚  â”‚     â”œâ”€ pages/
â”‚  â”‚     â””â”€ controllers/
â”‚  â”‚
â”‚  â””â”€ âš ï¸ warning/
â”‚     â””â”€ presentation/
â”‚        â”œâ”€ pages/
â”‚        â””â”€ controllers/
â”‚
â”œâ”€ ğŸ”— shared/                        [21 å€‹æ–‡ä»¶]
â”‚  â”œâ”€ widgets/            [15] AppBar, Card, Empty, Error...
â”‚  â””â”€ theme/              [5] Colors, Spacing, Radius, Text, Theme
â”‚
â””â”€ ğŸŒ l10n/                          [å¤šèªè¨€]
   â”œâ”€ intl_en.arb
   â”œâ”€ intl_zh_Hant.arb
   â””â”€ ... (13 ç¨®èªè¨€)

assets/
â””â”€ icons/                            [99 å€‹æ–‡ä»¶]
   â”œâ”€ ic_*.svg
   â”œâ”€ img_*.svg
   â””â”€ *.png
   (æ‰€æœ‰ icons çµ±ä¸€åœ¨æ ¹ç›®éŒ„ï¼Œç„¡å­åˆ†é¡)
```

---

## ğŸ”„ è³‡æ–™æµåœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI Layer (features/)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Pages   â”‚  â”‚ Widgets  â”‚  â”‚Controllersâ”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
â”‚       â”‚             â”‚             â”‚                    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                     â”‚                                   â”‚
â”‚                     â–¼                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚  Controllers â”‚                          â”‚
â”‚              â”‚  (åªèª¿ç”¨)    â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Business Logic Layer (domain/)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚         UseCases (å”¯ä¸€å…¥å£)              â”‚          â”‚
â”‚  â”‚  - connect_device                        â”‚          â”‚
â”‚  â”‚  - apply_led_scene                       â”‚          â”‚
â”‚  â”‚  - read_today_dose                       â”‚          â”‚
â”‚  â”‚  - write_doser_schedule                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                               â”‚
â”‚         â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚ Domain Rules â”‚                                      â”‚
â”‚  â”‚ - Device     â”‚                                      â”‚
â”‚  â”‚ - LED        â”‚                                      â”‚
â”‚  â”‚ - Doser      â”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Layer (data/)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚         Repositories                     â”‚          â”‚
â”‚  â”‚  - ble_device_repository                 â”‚          â”‚
â”‚  â”‚  - ble_led_repository                    â”‚          â”‚
â”‚  â”‚  - ble_doser_repository                  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                               â”‚
â”‚         â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚ Local Storageâ”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Core Layer (core/)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚         BLE (å¹³å°èƒ½åŠ›)                   â”‚          â”‚
â”‚  â”‚  - ble_client                            â”‚          â”‚
â”‚  â”‚  - ble_guard                             â”‚          â”‚
â”‚  â”‚  - ble_readiness_controller              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ–‡ä»¶çµ±è¨ˆ

| å±¤ç´š | ç›®éŒ„ | æ–‡ä»¶æ•¸ | èªªæ˜ |
|------|------|--------|------|
| **app/** | App é…ç½® | 2 | å•Ÿå‹•ã€å°èˆª |
| **core/** | æŠ€è¡“æ ¸å¿ƒ | 29 | BLEã€å¹³å°ã€éŒ¯èª¤ |
| **domain/** | æ¥­å‹™è¦å‰‡ | - | æ¥­å‹™é‚è¼¯ã€UseCase |
| **data/** | è³‡æ–™ä¾†æº | - | Repositoryã€Storage |
| **features/** | åŠŸèƒ½æ¨¡å¡Š | 71 | UIã€Controllerã€Widget |
| **shared/** | å…±äº«è³‡æº | 21 | Widgetã€Theme |
| **l10n/** | å¤šèªè¨€ | - | ARB æ–‡ä»¶ |
| **assets/icons/** | Icons | 99 | çµ±ä¸€åœ¨æ ¹ç›®éŒ„ |

---

## ğŸ¯ æ¶æ§‹è¦å‰‡

### âœ… ç¬¦åˆè¦å‰‡

1. **BLE åœ¨ core/** âœ…
   - BLE æ˜¯å¹³å°èƒ½åŠ›ï¼Œä¸æ˜¯åŠŸèƒ½
   - è¢« LEDã€Doserã€Warningã€Reconnect å…±ç”¨

2. **Controller ä¸ç›´æ¥è™•ç†æ¥­å‹™è¦å‰‡** âœ…
   - Controller åªèƒ½èª¿ç”¨ `domain/usecases/`
   - æ¥­å‹™è¦å‰‡åœ¨ `domain/` å±¤

3. **å…©å±¤ Widget çµæ§‹** âœ…
   - Feature-local: `features/{feature}/presentation/widgets/`
   - Shared: `shared/widgets/`

4. **shared åªèƒ½æ”¾ç„¡ç‹€æ…‹ UI** âœ…
   - âœ… å…è¨±ï¼šAppBar, Loading, Empty State
   - âŒ ç¦æ­¢ï¼šBLE, Controller, Device ç‹€æ…‹

5. **Icons çµ±ä¸€** âœ…
   - æ‰€æœ‰ icons åœ¨ `assets/icons/` æ ¹ç›®éŒ„
   - ç„¡å­åˆ†é¡

---

## ğŸ”— å°æ‡‰é—œä¿‚

### reef-b-app â†’ koralcore

| reef-b-app | koralcore | ç‹€æ…‹ |
|-----------|-----------|------|
| `MainActivity.kt` | `lib/app/main_scaffold.dart` | âœ… |
| `BLEManager.kt` | `lib/core/ble/ble_client.dart` | âœ… |
| `HomeFragment.kt` | `lib/features/home/presentation/pages/home_page.dart` | âœ… |
| `DeviceFragment.kt` | `lib/features/device/presentation/pages/device_page.dart` | âœ… |
| `adapter_device_led.xml` | `lib/features/device/presentation/widgets/device_card.dart` | âœ… |
| `res/values/colors.xml` | `lib/shared/theme/app_colors.dart` | âœ… |
| `res/values/styles.xml` | `lib/shared/theme/app_theme.dart` | âœ… |
| `res/drawable/*.xml` | `assets/icons/*.svg` | âœ… |

---

**ç‹€æ…‹**: æ¶æ§‹é‡æ§‹å®Œæˆï¼Œç¬¦åˆæ­£è¦ IoT Flutter æ¶æ§‹ âœ…

